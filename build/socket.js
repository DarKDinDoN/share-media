!function(){"use strict";var e={921:function(e,i,n){var s=n(574),t=n(856),a=n(749);const o=new class{init(){this._createContainer(),this._activateListeners()}_createContainer(){const e=game.user.isGM?`<button class="dismiss"><i class="fas fa-times"></i> ${game.i18n.localize(`${s.Z.moduleName}.share.fullscreen-dismiss-button`)}</button>`:"";this.container=$('<div id="fullscreen-layer" class="hidden"></div>').append(`\n                <div class="background"></div>\n                <img src="${s.Z.modulePath}/images/transparent.png" alt="">\n                <video playsinline src="" class="disabled"></video>\n                <div class="darkness"></div>\n                <div class="buttons">\n                    ${e}\n                    <button class="minimize" title="${game.i18n.localize(`${s.Z.moduleName}.share.fullscreen-minimize-button`)}">\n                        <i class="fas fa-window-minimize"></i>\n                    </button>\n                    <button class="maximize hidden" title="${game.i18n.localize(`${s.Z.moduleName}.share.fullscreen-maximize-button`)}">\n                        <i class="fas fa-window-maximize"></i>\n                    </button>\n                </div>\n                <div class="title hidden"></div>\n            `);const i=document.querySelectorAll(".gm-screen-app, #dice-box-canvas");i?.[0]?this.container.insertBefore($(i[0])):this.container.insertBefore($(document.getElementById("pause")))}_activateListeners(){this.container.find("button.dismiss").click((e=>(0,a.Xy)())),this.container.find("button.minimize").click((e=>this.toggleMinimize())),this.container.find("button.maximize").click((e=>this.toggleMinimize()))}handleShare(e,i="image",n="",a=!1,o=!1,d=!0){const r=this.container.find(".background"),l=this.container.find("img"),c=this.container.find("video"),m=c.get(0),u=this.container.find(".minimize"),h=this.container.find(".maximize"),g=this.container.find(".title"),f=this.container.find(".darkness");if(a?this.container.addClass("immersive-mode"):this.container.removeClass("immersive-mode"),"image"===i&&(e.endsWith(".jpg")?r.css("background-image",`url("${e}")`):r.css("background-image",`url("${s.Z.modulePath}/images/black.png")`),c.addClass("disabled"),l.attr("src",e),l.removeClass("disabled")),"video"===i&&(r.css("background-image",`url("${s.Z.modulePath}/images/black.png")`),l.addClass("disabled"),c.attr("src",e),c.removeClass("disabled"),m.loop=o,m.muted=d,m.onended=o?null:()=>this.handleDismiss(),m.play().catch((e=>{m.muted=!0,m.play()}))),n?(g.html(n),g.removeClass("hidden")):g.addClass("hidden"),game.settings.get(s.Z.moduleName,t.L.FULLSCREEN_DARKNESS_MODE)&&game.scenes.current){const e=game.scenes.current;f.css("opacity",e.darkness),f.css("background-color",`#${CONFIG.Canvas.darknessColor.toString(16)}`)}this.container.removeClass("hidden"),this.container.removeClass("minimized"),u.removeClass("hidden"),h.addClass("hidden")}handleDismiss(){const e=this.container.find(".background"),i=this.container.find("img"),n=this.container.find("video"),t=n.get(0),a=this.container.find(".title"),o=this.container.find(".darkness");e.css("background-image",`url("${s.Z.modulePath}/images/transparent.png")`),i.attr("src",`${s.Z.modulePath}/images/transparent.png`),t.pause(),n.attr("src",""),a.html(""),a.addClass("hidden"),o.css("opacity",0),o.css("background-color","transparent"),this.container.addClass("hidden")}toggleMinimize(e){const i=this.container.find(".minimize"),n=this.container.find(".maximize"),s=this.container.find(".title"),t=this.container.find(".darkness");i.toggleClass("hidden"),n.toggleClass("hidden"),s.toggleClass("hidden"),t.toggleClass("hidden"),this.container.toggleClass("minimized")}updateDarkness(e){if(game.settings.get(s.Z.moduleName,t.L.FULLSCREEN_DARKNESS_MODE)&&!this.container.hasClass("hidden")){const i=this.container.find(".darkness");i.css("opacity",e),i.css("background-color",`#${CONFIG.Canvas.darknessColor.toString(16)}`)}}};i.Z=o},574:function(e,i){i.Z={modulePath:"modules/share-media",moduleName:"share-media"}},856:function(e,i,n){n.d(i,{L:function(){return s}}),n(574),foundry.utils.debounce((()=>window.location.reload()),500);const s={DISABLE_CONTEXT_OPTIONS:"disable-context-options",VIDEO_LOOPING_OPTION:"video-looping-option",VIDEO_MUTE_OPTION:"video-muted-option",ENABLE_HUD_BUTTON:"enable-hud-button",FULLSCREEN_IMMERSIVE_MODE:"fullscreen-immersive-mode",FULLSCREEN_DARKNESS_MODE:"fullscreen-darkness-mode",SHARE_ACTOR_TOKEN_NAME:"popout-share-name",ENABLE_SCENE_COVER:"enable-scene-cover",BLACKLIST_FORM:"blacklist-form",BLACKLIST:"blacklist"}},749:function(e,i,n){n.d(i,{Xy:function(){return l}});var s=n(574);class t extends ImagePopout{constructor(e,i={}){super(e,i),this.video=[".mp4","webm"].includes(e.slice(-4).toLowerCase()),this.options.template=`${s.Z.modulePath}/templates/media-popout-dialog.hbs`}async getData(e){let i=await super.getData();return i.isVideo=this.video,i}static _handleShareMedia(e,i="",n=!1,s=!0){const t=new this(e,{title:i,shareable:!1,editable:!1}).render(!0);t.video&&setTimeout((()=>{const e=t.element.find("video")[0];e.loop=n,e.muted=s,e.onended=n?null:()=>t.close(!0),e.play().catch((i=>{e.muted=!0,e.play()}))}),250)}}var a=n(921);let o;Hooks.once("socketlib.ready",(()=>{o=socketlib.registerModule(s.Z.moduleName),o.register("sharePopoutMedia",d),o.register("shareFullscreenMedia",r),o.register("dismissFullscreenMedia",c)}));const d=(e,i="",n=!1,s=!0)=>{t._handleShareMedia(e,i,n,s)},r=(e,i="image",n="",s=!1,t=!1,o=!0)=>{a.Z.handleShare(e,i,n,s,t,o)},l=async()=>await o.executeForEveryone("dismissFullscreenMedia"),c=()=>{a.Z.handleDismiss()}}},i={};function n(s){var t=i[s];if(void 0!==t)return t.exports;var a=i[s]={exports:{}};return e[s](a,a.exports,n),a.exports}n.d=function(e,i){for(var s in i)n.o(i,s)&&!n.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:i[s]})},n.o=function(e,i){return Object.prototype.hasOwnProperty.call(e,i)},n(749)}();